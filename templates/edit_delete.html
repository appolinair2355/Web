<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Modifier / Supprimer â€“ Mont Sion de Bapkerou</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" height="40">
        <h1>âœï¸ğŸ—‘ï¸ Modifier / Supprimer â€“ Mont Sion de Bapkerou</h1>
        <a href="{{ url_for('index') }}">â† Retour</a>
    </nav>

    <main class="container">
        <h2>Liste des Ã©lÃ¨ves</h2>
        {% set data = load_data() %}
        {% set students = data['primaire'] + data['secondaire'] %}

        {% if students %}
            {% for s in students %}
            <div class="student-card">
                <h3>{{ s.prenoms }} {{ s.nom }} ({{ s.classe }})</h3>
                <a href="{{ url_for('edit_student', student_id=s.id) }}" class="btn-edit">âœï¸ Modifier</a>
                <button onclick="deleteStudent('{{ s.id }}', '{{ s.prenoms }} {{ s.nom }}')" class="btn-danger">ğŸ—‘ï¸ Supprimer</button>
            </div>
            {% endfor %}
        {% else %}
            <p>Aucun Ã©lÃ¨ve inscrit.</p>
        {% endif %}
    </main>

    <!-- Modal suppression sÃ©curisÃ©e -->
    <div id="deleteModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span onclick="closeDeleteModal()" style="float:right;cursor:pointer;">&times;</span>
            <h3>Supprimer lâ€™Ã©lÃ¨ve <span id="delName"></span> ?</h3>
            <label>Mot de passe : <input type="password" id="delPwd" placeholder="Mot de passe"></label><br>
            <button onclick="confirmDelete()" class="btn btn-danger">Confirmer</button>
            <button onclick="closeDeleteModal()" class="btn btn-secondary">Annuler</button>
        </div>
    </div>

    <script>
    let deleteStudentId = null;
    let deleteStudentName = null;

    function deleteStudent(id, name) {
        deleteStudentId = id;
        deleteStudentName = name;
        document.getElementById('delName').textContent = name;
        document.getElementById('delPwd').value = '';
        document.getElementById('deleteModal').style.display = 'block';
    }

    function closeDeleteModal() {
        document.getElementById('deleteModal').style.display = 'none';
    }

    function confirmDelete() {
        const pwd = document.getElementById('delPwd').value;
        if (pwd !== 'arrow') {
            alert('Mot de passe incorrect');
            return;
        }
        fetch(`/delete/${deleteStudentId}`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({password: pwd})
        }).then(res => res.json()).then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert(data.message);
            }
        });
    }
    </script>
</body>
    </html>
    
