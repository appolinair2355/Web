<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Notes ‚Äì {{ classe }} ‚Äì {{ matiere }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" height="40">
        <h1>üìù {{ matiere }} ‚Äì {{ classe }} ‚Äì {{ prof }}</h1>
        <a href="{{ url_for('notes') }}">‚Üê Retour</a>
    </nav>

    <main class="container">
        <h2>Liste des √©l√®ves</h2>
        <table class="fees-table">
            <thead><tr><th>Nom & Pr√©noms</th><th>Note</th><th>Action</th></tr></thead>
            <tbody>
                {% for s in eleves %}
                <tr>
                    <td>{{ s.prenoms }} {{ s.nom }}</td>
                    <td>
                        <input type="number" min="0" max="20" step="0.5" 
                               id="note-{{ s.id }}" value="{{ s.notes.get(matiere, '') }}" 
                               {% if matiere in s.notes %}readonly{% endif %}>
                    </td>
                    <td>
                        {% if matiere not in s.notes %}
                        <button onclick="addNote('{{ s.id }}', '{{ matiere }}')">Ajouter</button>
                        {% else %}
                        <button onclick="editNote('{{ s.id }}', '{{ matiere }}')">‚úèÔ∏è</button>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </main>

    <script>
    function addNote(id, matiere){
        const note = parseFloat(document.getElementById('note-'+id).value);
        if(isNaN(note)){alert('Note invalide');return;}
        fetch('/add_note', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({student_id:id,matiere:matiere,note:note})
        }).then(r=>r.json()).then(d=>{if(d.success)location.reload();});
    }
    function editNote(id, matiere){
        const pwd = prompt('Mot de passe pour modifier :');
        if(pwd !== 'Kouam√©'){alert('Mot de passe incorrect');return;}
        const note = parseFloat(prompt('Nouvelle note :'));
        if(isNaN(note)){alert('Note invalide');return;}
        fetch('/edit_note', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({student_id:id,matiere:matiere,note:note,password:pwd})
        }).then(r=>r.json()).then(d=>{if(d.success)location.reload();});
    }
    </script>
</body>
</html>
